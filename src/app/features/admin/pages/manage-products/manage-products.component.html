<div class="max-w-7xl mx-auto py-6 px-4">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-900">Gestionar Productos</h1>
    <button (click)="openNewProduct()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
      + Nuevo Producto
    </button>
  </div>

  <!-- Error State -->
  @if (error()) {
  <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
    <p class="text-red-600">{{ error() }}</p>
    <button (click)="loadProducts()" class="mt-2 text-sm text-red-700 underline">
      Reintentar
    </button>
  </div>
  }

  <!-- Loading State -->
  @if (loading()) {
  <div class="flex justify-center py-12">
    <p class="text-gray-500">Cargando productos...</p>
  </div>
  }

  <!-- Products Table -->
  @if (!loading()) {
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <table class="table-auto w-full">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Nombre</th>
          <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">Precio</th>
          <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700">Stock</th>
          <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700">Estado</th>
          <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700">Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (product of products(); track product.id) {
        <tr class="border-t border-gray-100 hover:bg-gray-50">
          <td class="px-4 py-3 text-sm text-gray-900">{{ product.name }}</td>
          <td class="px-4 py-3 text-right text-sm text-gray-600">
            {{ product.price | currency:'COP':'symbol-narrow':'1.0-0' }}
          </td>
          <td class="px-4 py-3 text-center text-sm text-gray-600">{{ product.stock }}</td>
          <td class="px-4 py-3 text-center">
            <span class="px-2 py-1 rounded-full text-sm"
              [class]="product.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
              {{ product.isActive ? 'Activo' : 'Inactivo' }}
            </span>
          </td>
          <td class="px-4 py-3 text-center">
            <div class="flex justify-center gap-2">
              <button (click)="openEditProduct(product)"
                class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 text-sm">
                Editar
              </button>
              <button (click)="openToggleDialog(product)" [class]="product.isActive 
                            ? 'bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm'
                            : 'bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 text-sm'">
                {{ product.isActive ? 'Desactivar' : 'Activar' }}
              </button>
            </div>
          </td>
        </tr>
        } @empty {
        <tr>
          <td colspan="5" class="px-4 py-8 text-center text-gray-500">
            No hay productos registrados
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  }

  <!-- Product Form Modal -->
  @if (showFormModal()) {
  <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 max-w-md w-full mx-4">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">
        {{ editingProduct() ? 'Editar Producto' : 'Nuevo Producto' }}
      </h3>

      <form [formGroup]="productForm" (ngSubmit)="onSubmitProduct()">
        <!-- Nombre -->
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-1">Nombre *</label>
          <input type="text" formControlName="name" class="border rounded px-3 py-2 w-full"
            placeholder="Nombre del producto">
          @if (productForm.get('name')?.invalid && productForm.get('name')?.touched) {
          <p class="text-red-500 text-sm mt-1">El nombre es requerido</p>
          }
        </div>

        <!-- Descripción -->
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-1">Descripción</label>
          <textarea formControlName="description" class="border rounded px-3 py-2 w-full" rows="3"
            placeholder="Descripción del producto"></textarea>
        </div>

        <!-- Precio y Stock -->
        <div class="grid grid-cols-2 gap-4 mb-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Precio *</label>
            <input type="number" formControlName="price" class="border rounded px-3 py-2 w-full" min="0" step="100">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Stock *</label>
            <input type="number" formControlName="stock" class="border rounded px-3 py-2 w-full" min="0">
          </div>
        </div>

        <!-- URL Imagen -->
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-1">URL de Imagen</label>
          <input type="text" formControlName="imageUrl" class="border rounded px-3 py-2 w-full"
            placeholder="https://...">
        </div>

        <!-- Activo -->
        <div class="mb-6">
          <label class="flex items-center">
            <input type="checkbox" formControlName="isActive" class="rounded border-gray-300 text-blue-600 mr-2">
            <span class="text-sm text-gray-700">Producto activo</span>
          </label>
        </div>

        <!-- Botones -->
        <div class="flex justify-end space-x-3">
          <button type="button" (click)="closeFormModal()" class="bg-gray-200 px-4 py-2 rounded hover:bg-gray-300">
            Cancelar
          </button>
          <button type="submit" [disabled]="productForm.invalid || formLoading()"
            class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:bg-gray-300">
            @if (formLoading()) {
            Guardando...
            } @else {
            {{ editingProduct() ? 'Actualizar' : 'Crear' }}
            }
          </button>
        </div>
      </form>
    </div>
  </div>
  }

  <!-- Confirm Toggle Dialog -->
  <app-confirm-dialog [isOpen]="showDeleteDialog()"
    [title]="productToToggle()?.isActive ? 'Desactivar Producto' : 'Activar Producto'" [message]="productToToggle()?.isActive 
      ? '¿Estás seguro de desactivar este producto? Los usuarios no podrán verlo.'
      : '¿Estás seguro de activar este producto? Estará visible para los usuarios.'"
    [confirmText]="productToToggle()?.isActive ? 'Desactivar' : 'Activar'" cancelText="Cancelar" [confirmButtonClass]="productToToggle()?.isActive 
      ? 'bg-red-600 text-white hover:bg-red-700'
      : 'bg-green-600 text-white hover:bg-green-700'" (confirmed)="onConfirmToggle($event)">
  </app-confirm-dialog>
</div>