<div class="max-w-4xl mx-auto py-6 px-4">
  <!-- Back button -->
  <a routerLink="/orders" class="text-blue-600 hover:underline mb-4 inline-block">
    ← Volver a mis pedidos
  </a>

  <h1 class="text-2xl font-bold text-gray-900 mb-6">Detalle del Pedido</h1>

  <!-- Loading State -->
  @if (loading()) {
  <div class="flex justify-center py-12">
    <p class="text-gray-500">Cargando pedido...</p>
  </div>
  }

  <!-- Error State -->
  @if (error()) {
  <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
    <p class="text-red-600">{{ error() }}</p>
  </div>
  }

  <!-- Order Details -->
  @if (order()) {
  <!-- Order Info Card -->
  <div class="bg-white rounded-lg shadow p-6 mb-6">
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div>
        <p class="text-sm text-gray-500">ID del Pedido</p>
        <p class="font-semibold text-gray-900">#{{ order()!.id | slice:0:8 }}</p>
      </div>
      <div>
        <p class="text-sm text-gray-500">Fecha</p>
        <p class="font-semibold text-gray-900">{{ order()!.createdAt | date:'dd/MM/yyyy HH:mm' }}</p>
      </div>
      <div>
        <p class="text-sm text-gray-500">Estado</p>
        <span class="inline-block px-2 py-1 rounded-full text-sm mt-1" [class]="getStatusClass(order()!.status)">
          {{ getStatusLabel(order()!.status) }}
        </span>
      </div>
      <div>
        <p class="text-sm text-gray-500">Total</p>
        <p class="font-bold text-xl text-blue-600">
          {{ order()!.total | currency:'COP':'symbol-narrow':'1.0-0' }}
        </p>
      </div>
    </div>
  </div>

  <!-- Order Items Table -->
  <div class="bg-white rounded-lg shadow overflow-hidden mb-6">
    <h3 class="text-lg font-semibold text-gray-900 p-4 border-b">Productos</h3>
    <table class="table-auto w-full">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Producto</th>
          <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700">Cantidad</th>
          <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">Precio Unit.</th>
          <th class="px-4 py-3 text-right text-sm font-semibold text-gray-700">Subtotal</th>
        </tr>
      </thead>
      <tbody>
        @for (item of order()!.items; track item.productId) {
        <tr class="border-t border-gray-100">
          <td class="px-4 py-3 text-sm text-gray-900">{{ item.product?.name || item.productName || item.productId }}</td>
          <td class="px-4 py-3 text-center text-sm text-gray-600">{{ item.quantity }}</td>
          <td class="px-4 py-3 text-right text-sm text-gray-600">
            {{ item.price | currency:'COP':'symbol-narrow':'1.0-0' }}
          </td>
          <td class="px-4 py-3 text-right text-sm font-semibold text-gray-900">
            {{ (item.price * item.quantity) | currency:'COP':'symbol-narrow':'1.0-0' }}
          </td>
        </tr>
        }
      </tbody>
      <tfoot class="bg-gray-50">
        <tr>
          <td colspan="3" class="px-4 py-3 text-right font-semibold text-gray-900">Total:</td>
          <td class="px-4 py-3 text-right font-bold text-blue-600">
            {{ order()!.total | currency:'COP':'symbol-narrow':'1.0-0' }}
          </td>
        </tr>
      </tfoot>
    </table>
  </div>

  <!-- Cancel Button (only for PENDING) -->
  @if (order()!.status === OrderStatus.PENDING) {
  <div class="flex justify-end">
    <button (click)="openCancelDialog()" class="bg-red-500 text-white px-6 py-2 rounded hover:bg-red-600">
      Cancelar Pedido
    </button>
  </div>
  }
  }

  <!-- Confirm Cancel Dialog -->
  <app-confirm-dialog [isOpen]="showCancelDialog()" title="Cancelar Pedido"
    message="¿Estás seguro de cancelar este pedido? Esta acción no se puede deshacer." confirmText="Sí, cancelar"
    cancelText="No, mantener" confirmButtonClass="bg-red-600 text-white hover:bg-red-700"
    (confirmed)="onConfirmCancel($event)">
  </app-confirm-dialog>
</div>